# –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å Pydantic ‚úÖ

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã –Ω–∞—É—á–∏–ª–∏—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥–∏ RabbitMQ. –¢–µ–ø–µ—Ä—å –ø–æ—Ä–∞ —Å–¥–µ–ª–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ—â–Ω–µ–µ! –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –¥–æ–±–∞–≤–∏–º **Pydantic** ‚Äî —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å JSON-—Å–æ–æ–±—â–µ–Ω–∏—è —Å —á–µ—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å. –ì–æ—Ç–æ–≤—ã —É–ª—É—á—à–∏—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ? –ü–æ–≥–Ω–∞–ª–∏! üöÄ

## –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Pydantic? ü§î

–ö–æ–≥–¥–∞ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –±—Ä–æ–∫–µ—Ä–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –æ—à–∏–±–∫–∏, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω—É–∂–Ω–æ–µ –ø–æ–ª–µ –∏–ª–∏ –ø–æ–ª–µ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø. **Pydantic** —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É:

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ** üìã: –í—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ, –∫–∞–∫ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{ "username": str, "message": str }`).
- **–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** üõ°Ô∏è: –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, FastStream –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É.
- **–£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥** ‚ú®: –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –∞ –Ω–µ —Å —Å—ã—Ä—ã–º–∏ —Å–ª–æ–≤–∞—Ä—è–º–∏.

–í FastStream Pydantic –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω "–∏–∑ –∫–æ—Ä–æ–±–∫–∏", —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å JSON-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —É–¥–æ–±–Ω–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π. üòé

## –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚úçÔ∏è

–û–±–Ω–æ–≤–∏–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ `app.py`, —á—Ç–æ–±—ã –æ–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ JSON-—Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–ª—è–º–∏ `username` –∏ `message`. –û—Ç–∫—Ä–æ–π—Ç–µ `app.py` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –∫–æ–¥:

```python
--8<-- "src/tutorial/pydantic/app.py"
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?** üîç

- **–ú–æ–¥–µ–ª—å `UserMessage`**: –ö–ª–∞—Å—Å Pydantic —Å –ø–æ–ª—è–º–∏ `username` –∏ `message`. –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (`Field`) –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ –≤ —Ä–∞–∑–¥–µ–ª–µ –ø—Ä–æ AsyncAPI.
- **`@broker.subscriber`**: –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –Ω–∞ –æ—á–µ—Ä–µ–¥–∏ `input-queue` –∏ `output-queue`.
- **`handle_message`**: –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç `UserMessage`, –ª–æ–≥–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π `UserMessage` —Å `message` –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ –≤ `output-queue`.
- **`check_result`**: –õ–æ–≥–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ `output-queue`, –ø–æ–∫–∞–∑—ã–≤–∞—è, –∫–∞–∫ –≤—Ç–æ—Ä–æ–π —Å–µ—Ä–≤–∏—Å (–≤–Ω—É—Ç—Ä–∏ —Ç–æ–≥–æ –∂–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ.
- **`broker.publish`**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ `output-queue`.

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ** üåê: –í —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö `check_result` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Å–µ—Ä–≤–∏—Å–µ, –∫–∞–∫ –≤—ã –≤–∏–¥–µ–ª–∏ –≤ `app2.py` –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ä–∞–∑–¥–µ–ª–µ.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–ø—Ä–∞–≤–∫–∏** üì§  
–í–º–µ—Å—Ç–æ `broker.publish` –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `@broker.publisher`:

```python
@broker.subscriber("input-queue")
@broker.publisher("output-queue")
async def handle_message(data: UserMessage, logger: Logger) -> UserMessage:
    logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ: {data.username} —Å–∫–∞–∑–∞–ª '{data.message}'")
    return UserMessage(username=data.username, message=data.message.upper())
```

–ü–æ—Ä—è–¥–æ–∫ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –≤–∞–∂–µ–Ω: `@broker.subscriber` ‚Äî –≤–Ω–µ—à–Ω–∏–π, `@broker.publisher` ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ –ø–µ—Ä–≤—ã–π —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–∞, –∞ –≤—Ç–æ—Ä–æ–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

## –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π üì¨

–û–±–Ω–æ–≤–∏–º —Å–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑—É—è –≤–∞—à—É –≤–µ—Ä—Å–∏—é. –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ `send_message.py`:

```python
--8<-- "src/tutorial/pydantic/send_message.py"
```

**–ü–æ—á–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä?** üîå –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä (`async with`) –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ `broker.connect()` –∏ `broker.close()`, —á—Ç–æ –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –±–µ–∑ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.

## –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π ‚ñ∂Ô∏è

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ RabbitMQ** (–µ—Å–ª–∏ –Ω–µ –∑–∞–ø—É—â–µ–Ω):
   ```bash
   docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:
   ```bash
   faststream run app:app
   ```
   –í—ã–≤–æ–¥:
   ```
   INFO     - FastStream app starting...
   INFO     - input-queue  |            - `handle_message` waiting for messages
   INFO     - output-queue |            - `check_result` waiting for messages
   INFO     - FastStream app started successfully! To exit press CTRL+C
   ```

3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**:
   ```bash
   python send_message.py
   ```
   –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
   ```
   INFO     - input-queue  |            - –ü–æ–ª—É—á–µ–Ω–æ: Alice —Å–∫–∞–∑–∞–ª 'Hello'
   INFO     - output-queue |            - –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: Alice —Å–∫–∞–∑–∞–ª 'HELLO'
   ```

FastStream –ø–æ–ª—É—á–∏–ª JSON, –ø—Ä–æ–≤–µ—Ä–∏–ª –µ–≥–æ —á–µ—Ä–µ–∑ Pydantic, –æ–±—Ä–∞–±–æ—Ç–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø–µ—Ä–µ–¥–∞–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `output-queue`, –≥–¥–µ –≤—Ç–æ—Ä–æ–π –ø–æ–¥–ø–∏—Å—á–∏–∫ –ø–æ–∫–∞–∑–∞–ª –µ–≥–æ –≤ –ª–æ–≥–∞—Ö. –í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ üõ°Ô∏è

Pydantic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä–∏–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–µ–≤–µ—Ä–Ω–æ–≥–æ JSON. –°–æ–∑–¥–∞–π—Ç–µ `send_message_invalid.py`:

```python
--8<-- "src/tutorial/pydantic/send_message_invalid.py"
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
python send_message.py
```

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
```
ERROR    - input-queue |            - Validation error: ...
```

Pydantic –æ—Ç–∫–ª–æ–Ω–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑-–∑–∞ `wrong_field`, –∑–∞—â–∏—â–∞—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö! ‚úÖ

## –®–∞–≥ 5: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ üìö

–ó–∞–∫—Ä–µ–ø–∏—Ç–µ –∑–Ω–∞–Ω–∏—è:

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `UserMessage` –ø–æ–ª–µ `timestamp: datetime`, –æ–±–Ω–æ–≤–∏—Ç–µ `handle_message`, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∞—Ç—å —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É (`datetime.now()`), –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ª–æ–≥–∞—Ö `check_result`.
2. –ò–∑–º–µ–Ω–∏—Ç–µ `send_message.py`, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å `timestamp`, –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é.
3. (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `message` —Å `min_length=1` –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

## –ß—Ç–æ –¥–∞–ª—å—à–µ? üó∫Ô∏è

–í—ã –Ω–∞—É—á–∏–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pydantic –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π! üéâ –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞–¥–µ–∂–Ω—ã–º. –í —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ [**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**](./testing.md), —á—Ç–æ–±—ã –æ—Å–≤–æ–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è FastStream.

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å, –∑–∞–≥–ª—è–Ω–∏—Ç–µ –≤ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é FastStream](https://faststream.airt.ai/latest/), –ø–∏—à–∏—Ç–µ –≤ [Telegram](https://t.me/python_faststream) –∏–ª–∏ [Discord](https://discord.gg/qFm6aSqq59). –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∫–æ–¥–∏—Ç—å! üöÄ
