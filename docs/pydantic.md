# –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å Pydantic ‚úÖ

–í –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ä–∞–∑–¥–µ–ª–µ –≤—ã —Å–æ–∑–¥–∞–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–æ—Å—Ç—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –¢–µ–ø–µ—Ä—å –ø–æ—Ä–∞ —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ –º–æ—â–Ω–µ–µ! –í —ç—Ç–æ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã –¥–æ–±–∞–≤–∏–º **Pydantic** ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫—É –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö. –≠—Ç–æ –ø–æ–∑–≤–æ–ª–∏—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å JSON-—Å–æ–æ–±—â–µ–Ω–∏—è —Å —á–µ—Ç–∫–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å. –ì–æ—Ç–æ–≤—ã —É–ª—É—á—à–∏—Ç—å –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ? –ü–æ–≥–Ω–∞–ª–∏! üöÄ

## –ó–∞—á–µ–º –Ω—É–∂–µ–Ω Pydantic? ü§î

–ö–æ–≥–¥–∞ –≤—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å –±—Ä–æ–∫–µ—Ä–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, –¥–∞–Ω–Ω—ã–µ —á–∞—Å—Ç–æ –ø—Ä–∏—Ö–æ–¥—è—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON. –ë–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–µ–≥–∫–æ –ø–æ–ª—É—á–∏—Ç—å –æ—à–∏–±–∫–∏, –µ—Å–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–æ–æ–±—â–µ–Ω–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω—É–∂–Ω–æ–µ –ø–æ–ª–µ –∏–ª–∏ –ø–æ–ª–µ –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø. **Pydantic** —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É:

- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ** üìã: –í—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ, –∫–∞–∫ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `{ "username": str, "message": str }`).
- **–í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** üõ°Ô∏è: –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–µ, FastStream –≤—ã–±—Ä–æ—Å–∏—Ç –æ—à–∏–±–∫—É.
- **–£–ø—Ä–æ—â–∞–µ—Ç –∫–æ–¥** ‚ú®: –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –æ–±—ä–µ–∫—Ç–∞–º–∏, –∞ –Ω–µ —Å —Å—ã—Ä—ã–º–∏ —Å–ª–æ–≤–∞—Ä—è–º–∏.

–í FastStream Pydantic –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω "–∏–∑ –∫–æ—Ä–æ–±–∫–∏", —á—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å JSON-—Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ —É–¥–æ–±–Ω–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π. üòé

## –®–∞–≥ 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚úçÔ∏è

–î–∞–≤–∞–π—Ç–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ–º –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–∑ `app.py`, —á—Ç–æ–±—ã –æ–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–æ JSON-—Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø–æ–ª—è–º–∏ `username` –∏ `message`. –û—Ç–∫—Ä–æ–π—Ç–µ `app.py` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π:

```python
from pydantic import BaseModel, Field
from faststream import FastStream, Logger
from faststream.rabbit import RabbitBroker

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–æ–æ–±—â–µ–Ω–∏—è
class UserMessage(BaseModel):
    username: str = Field(..., examples=["Alice"], description="–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    message: str = Field(..., examples=["Hello"], description="–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è")

# –°–æ–∑–¥–∞–µ–º –±—Ä–æ–∫–µ—Ä –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
broker = RabbitBroker("amqp://guest:guest@localhost:5672/")
app = FastStream(broker)

# –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –æ—á–µ—Ä–µ–¥—å –∏ –ø—É–±–ª–∏–∫—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
@broker.subscriber("input-queue")
@broker.publisher("output-queue")
async def handle_message(data: UserMessage, logger: Logger) -> UserMessage:
    logger.info(f"–ü–æ–ª—É—á–µ–Ω–æ: {data.username} —Å–∫–∞–∑–∞–ª '{data.message}'")
    return UserMessage(
        username=data.username,
        message=data.message.upper()
    )
```

**–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?** üîç

- **–ú–æ–¥–µ–ª—å `UserMessage`** üìã: –ú—ã —Å–æ–∑–¥–∞–ª–∏ –∫–ª–∞—Å—Å Pydantic —Å –¥–≤—É–º—è –ø–æ–ª—è–º–∏: `username` (—Å—Ç—Ä–æ–∫–∞) –∏ `message` (—Å—Ç—Ä–æ–∫–∞). `Field(..., examples=["..."], description="...")` –¥–æ–±–∞–≤–ª—è–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è –≤ `handle_message`** ‚úÖ: –§—É–Ω–∫—Ü–∏—è —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç `UserMessage` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–∫–∏. FastStream –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª–∏.
- **–í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞** üì§: –ú—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç `UserMessage` —Å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º (–≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ).
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** üìú: –õ–æ–≥ —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–æ–æ–±—â–µ–Ω–∏–µ.

## –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π üì¨

–ß—Ç–æ–±—ã –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–∏–º —Å–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π. –û—Ç–∫—Ä–æ–π—Ç–µ `send_message.py` –∏ –∑–∞–º–µ–Ω–∏—Ç–µ –∫–æ–¥:

```python
from faststream.rabbit import RabbitBroker

async def send_message():
    async with RabbitBroker("amqp://guest:guest@localhost:5672/") as broker:
        await broker.publish(
            {"username": "Alice", "message": "Hello"},
            queue="input-queue"
        )

if __name__ == "__main__":
    import asyncio
    asyncio.run(send_message())
```

**–ü–æ—á–µ–º—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä?** üîå –ö–∞–∫ –º—ã —É–∑–Ω–∞–ª–∏ —Ä–∞–Ω–µ–µ, –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä (`async with`) –∏–¥–µ–∞–ª–µ–Ω –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π, —Ç–∞–∫ –∫–∞–∫ –æ–Ω –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ `broker.connect()` –∏ `broker.close()`, –∞ –Ω–µ `broker.start()`. –≠—Ç–æ –ø–æ–¥—Ö–æ–¥–∏—Ç, –ø–æ—Ç–æ–º—É —á—Ç–æ –∑–¥–µ—Å—å –Ω–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤.

## –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ‚ñ∂Ô∏è

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ RabbitMQ** (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–ø—É—â–µ–Ω):

   ```bash
   docker run -it --rm --name rabbitmq -p 5672:5672 -p 15672:15672 rabbitmq:3-management
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**:

   ```bash
   faststream run app:app
   ```

   –í—ã —É–≤–∏–¥–∏—Ç–µ:

   ```
   INFO     - FastStream app starting...
   INFO     - input-queue |            - `handle_message` waiting for messages
   INFO     - FastStream app started successfully! To exit press CTRL+C
   ```

3. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ**:

   ```bash
   python send_message.py
   ```

   –í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ—è–≤–∏—Ç—Å—è:

   ```
   INFO     - input-queue |            - –ü–æ–ª—É—á–µ–Ω–æ: Alice —Å–∫–∞–∑–∞–ª 'Hello'
   ```

   FastStream –ø–æ–ª—É—á–∏–ª JSON, –ø—Ä–æ–≤–µ—Ä–∏–ª –µ–≥–æ —á–µ—Ä–µ–∑ Pydantic –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç (`{"username": "Alice", "message": "HELLO"}`) –≤ `output-queue`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —ç—Ç–æ –≤ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ RabbitMQ (`http://localhost:15672`, —Ä–∞–∑–¥–µ–ª **Queues**, –æ—á–µ—Ä–µ–¥—å `output-queue`, —Ñ—É–Ω–∫—Ü–∏—è **Get Messages**).

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ üõ°Ô∏è

Pydantic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–π JSON. –ò–∑–º–µ–Ω–∏—Ç–µ `send_message.py`:

```python
from faststream.rabbit import RabbitBroker

async def send_message():
    async with RabbitBroker("amqp://guest:guest@localhost:5672/") as broker:
        await broker.publish(
            {"username": "Alice", "wrong_field": "Hello"},  # –ù–µ–≤–µ—Ä–Ω–æ–µ –ø–æ–ª–µ
            queue="input-queue"
        )

if __name__ == "__main__":
    import asyncio
    asyncio.run(send_message())
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
python send_message.py
```

–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
ERROR    - input-queue |            - Validation error: ...
```

Pydantic –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ –ø–æ–ª–µ `wrong_field` –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –º–æ–¥–µ–ª–∏ `UserMessage`, –∏ –æ—Ç–∫–ª–æ–Ω–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ. –≠—Ç–æ –∑–∞—â–∏—â–∞–µ—Ç –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö! ‚úÖ

## –®–∞–≥ 5: –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ üìö

–ó–∞–∫—Ä–µ–ø–∏—Ç–µ –∑–Ω–∞–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –∑–∞–¥–∞–Ω–∏–π:

1. –î–æ–±–∞–≤—å—Ç–µ –≤ –º–æ–¥–µ–ª—å `UserMessage` –Ω–æ–≤–æ–µ –ø–æ–ª–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, `timestamp: str`, –∏ –æ–±–Ω–æ–≤–∏—Ç–µ `handle_message`, —á—Ç–æ–±—ã –≤–∫–ª—é—á–∞—Ç—å –µ–≥–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
2. –ò–∑–º–µ–Ω–∏—Ç–µ `send_message.py`, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º –ø–æ–ª–µ–º, –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `output-queue`.
3. (–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ) –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `Field` –≤ –º–æ–¥–µ–ª–∏ —Ç–∞–∫, —á—Ç–æ–±—ã `message` –Ω–µ –º–æ–≥ –±—ã—Ç—å –ø—É—Å—Ç–æ–π —Å—Ç—Ä–æ–∫–æ–π (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `min_length=1`).

## –ß—Ç–æ –¥–∞–ª—å—à–µ? üó∫Ô∏è

–í—ã –Ω–∞—É—á–∏–ª–∏—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Pydantic –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ FastStream! üéâ –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–º –∏ –≥–æ—Ç–æ–≤—ã–º –∫ —Ä–µ–∞–ª—å–Ω—ã–º –∑–∞–¥–∞—á–∞–º. –í —Å–ª–µ–¥—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ –º—ã —É–∑–Ω–∞–µ–º, –∫–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ [**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**](./testing.md), —á—Ç–æ–±—ã –æ—Å–≤–æ–∏—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è FastStream.

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ, –∑–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ [Telegram](https://t.me/python_faststream) –∏–ª–∏ [Discord](https://discord.gg/qFm6aSqq59) —Å–æ–æ–±—â–µ—Å—Ç–≤–∞—Ö FastStream. –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –∫–æ–¥–∏—Ç—å! üöÄ
